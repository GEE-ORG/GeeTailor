!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.GeeTailor=i()}(this,function(){"use strict";function t(t,i){function n(t,i){Object.keys(i).forEach(function(s){if(s in t){var o=e(t[s]);"[object Object]"===o||"[object Array]"===o?(t[s]=Object.create(t[s]),n(t[s],i[s])):t[s]=i[s]}})}var s=Object.create(t);return n(s,i),s}function i(t){if("undefined"!=typeof Promise&&n(Promise))Promise.resolve().then(function(){t()}).catch(function(t){return console.error(t)});else if("undefined"==typeof MutationObserver||!n(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())setTimeout(t,0);else{var i=new MutationObserver(t),e=document.createTextNode(s+"");i.observe(e,{characterData:!0}),e.data=++s+"",s=0}}function e(t){return Object.prototype.toString.call(t)}function n(t){return/[native code]/.test(t.toString())}var s=0,o=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},h=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),a={width:200,height:200,mode:"avatar",maskType:"circle"};return function(){function e(n,s){o(this,e),this.dpr=window.devicePixelRatio||1,this.btns={},this.info={},this.svgMask=new Image,this.output=document.createElement("canvas"),this.outCtx=this.output.getContext("2d"),this.isMoving=!1,this.img=new Image,this.original={width:0,height:0},this.imgBounding={width:0,height:0,offsetX:0,offsetY:0},this.imgOffset={x:0,y:0},this.el="string"==typeof n?document.querySelector(n):n,this.option=t(a,s),this.el.innerHTML='\n<div class="gt-canvas" style="display: inline-block">\n    <canvas class="gt-img" style="background-color: rgba(0,0,0,.8)"></canvas>\n    <div class="gt-info">\n        <span class="gt-info_size"></span>\n        <span class="gt-info_color"></span>\n    </div>\n</div>\n<div class="gt-preview">\n    <img class="gt-preview_img" style="display: none" download="gt-img">\n</div>\n<section class="gt-ctrl">\n    <button class="gt-ctrl_upload">Upload</button>\n    <button class="gt-ctrl_export">Export</button>\n\n    <input class="gt-upload" type="file" accept="image/jpg,image/png" style="display: none">\n</section>\n',i(this.init.bind(this))}return h(e,[{key:"init",value:function(){var t=this;if(this.wrapper=this.el.querySelector(".gt-canvas"),this.info.size=this.el.querySelector(".gt-info_size"),this.info.color=this.el.querySelector(".gt-info_color"),this.canvas=this.el.querySelector(".gt-img"),this.preview=this.el.querySelector(".gt-preview_img"),this.upload=this.el.querySelector(".gt-upload"),this.btns.upload=this.el.querySelector(".gt-ctrl_upload"),this.btns.export=this.el.querySelector(".gt-ctrl_export"),this.ctx=this.canvas.getContext("2d"),this.ctx.scale(this.dpr,this.dpr),this.mode=this.option.mode,this.canvasInit(),this.previewInit(),"avatar"===this.mode){var i="circle"===this.option.maskType?'\n<svg width="100px" height="100px" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <path d="M0,0 L100,0 L100,100 L0,100 L0,0 Z M50,100 C77.6142375,100 100,77.6142375 100,50 C100,22.3857625 77.6142375,0 50,0 C22.3857625,0 0,22.3857625 0,50 C0,77.6142375 22.3857625,100 50,100 Z" id="Combined-Shape" stroke="none" fill-opacity="0.5" fill="#000000" fill-rule="evenodd"></path>\n</svg>':'\n<svg width="100px" height="100px" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <path d="M0,0 L100,0 L100,100 L0,100 L0,0 Z M10,10 L90,10 L90,90 L10,90 L10,10 Z" id="Combined-Shape" stroke="none" fill-opacity="0.5" fill="#000000" fill-rule="evenodd"></path>\n</svg>',e=this.toBlob(i,"image/svg+xml");this.svgMask.onload=function(){t.ctx.drawImage(t.svgMask,0,0,t.canvas.width,t.canvas.width)},this.svgMask.src=this.toUrl(e)}this.addEvents(),this.render(),console.log(this)}},{key:"canvasInit",value:function(){this.canvas.width=this.width*window.devicePixelRatio,this.canvas.height=this.height*window.devicePixelRatio;var t=this.canvas.width*(1/window.devicePixelRatio)+"px",i=this.canvas.height*(1/window.devicePixelRatio)+"px";this.canvas.style.width=this.wrapper.style.width=t,this.canvas.style.height=this.wrapper.style.height=i}},{key:"render",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBg(),this.drawImg(),this.drawMask(),this.setPreview()}},{key:"drawBg",value:function(){}},{key:"drawImg",value:function(){this.ctx.drawImage(this.img,this.imgBounding.offsetX,this.imgBounding.offsetY,this.imgBounding.width,this.imgBounding.height)}},{key:"drawMask",value:function(){this.ctx.drawImage(this.svgMask,0,0,this.canvas.width,this.canvas.width)}},{key:"previewInit",value:function(){var t="\n            display: inline-block;\n            width: "+this.width+"px;\n            height: "+this.height+"px;\n            background: rgba(0,0,0,.8);\n            background-size: contain;\n        ";"avatar"===this.mode&&"circle"===this.option.maskType&&(t+="border-radius: 50%"),this.preview.parentElement.style.cssText=t}},{key:"setPreview",value:function(){this.preview.style.backgroundImage="url("+this.canvas.toDataURL()+")"}},{key:"addEvents",value:function(){var t=this;this.btns.upload.addEventListener("click",function(){t.upload.click()}),this.btns.export.addEventListener("click",function(){t.download()}),this.upload.addEventListener("change",function(i){var e=i.target.files[0],n=t.toUrl(e);if(!/image\/(jpg|jpeg|png)/.test(e.type))return void console.error("Only support jpg and png format.");URL.revokeObjectURL(t.img.src),t.img.onload=function(){t.imgInit()},t.img.src=n});var i=void 0;document.addEventListener("wheel",function(e){if(e.target===t.canvas){t.isMoving=!0,i&&clearTimeout(i),e.preventDefault();var n=e.wheelDeltaY;if(!(n<0&&t.imgBounding.width<t.canvas.width/5)){t.imgBounding.width+=n,t.imgBounding.height+=n/t.ratio;var s=t.center(t.imgBounding.width,t.imgBounding.height);t.imgBounding.offsetX=s.offsetX+t.imgOffset.x,t.imgBounding.offsetY=s.offsetY+t.imgOffset.y,requestAnimationFrame(t.render.bind(t)),i=setTimeout(function(){t.isMoving=!1,t.setPreview()},100)}}});var e=!1,n={x:0,y:0},s={x:this.imgBounding.offsetX,y:this.imgBounding.offsetY};document.addEventListener("mousedown",function(i){i.target===t.canvas&&(e=!0,t.isMoving=!0,console.log(i),n.x=i.offsetX,n.y=i.offsetY)}),document.addEventListener("mousemove",function(i){e&&(t.imgOffset.x=i.offsetX-n.x,t.imgOffset.y=i.offsetY-n.y,t.imgBounding.offsetX=(s.x+t.imgOffset.x)/2,t.imgBounding.offsetY=(s.y+t.imgOffset.y)/2,requestAnimationFrame(t.render.bind(t)))}),document.addEventListener("mouseup",function(i){e=!1,t.isMoving=!1,t.setPreview()})}},{key:"imgInit",value:function(){var t=(this.option,this.img);if(this.original.width=t.naturalWidth,this.original.height=t.naturalHeight,this.ratio=t.width/t.height,this.imgBounding.width=t.width,this.imgBounding.height=t.height,t.width>this.option.width){var i=this.canvas.width/t.width;this.imgBounding.width=this.canvas.width,this.imgBounding.height=i*this.imgBounding.height}if(t.height>this.option.height){var e=this.canvas.height/this.imgBounding.height;this.imgBounding.height=this.canvas.height,this.imgBounding.width*=e}this.imgBounding.offsetX=(this.canvas.width-this.imgBounding.width)/2,this.imgBounding.offsetY=(this.canvas.height-this.imgBounding.height)/2,this.render()}},{key:"center",value:function(t,i){return{offsetX:(this.canvas.width-t)/2,offsetY:(this.canvas.height-i)/2}}},{key:"toBlob",value:function(t,i){return new Blob([t],{type:i})}},{key:"toUrl",value:function(t){return URL.createObjectURL(t)}},{key:"download",value:function(){var t=this,i=this.canvas.width,e=this.canvas.height;this.output.width=i,this.output.height=e,this.outCtx.beginPath(),"avatar"===this.mode&&"circle"===this.option.maskType&&this.outCtx.arc(i/2,e/2,i/2,0,2*Math.PI,!0),this.outCtx.clip(),this.outCtx.drawImage(this.canvas,0,0,i,e);var n=document.createElement("a");n.download="gt-img",this.output.toBlob(function(i){n.href=t.toUrl(i),n.click()})}},{key:"mode",set:function(t){switch(this._mode=t,t){case"avatar":var i,e;this.option.width>this.option.height?(i=[this.option.height,this.option.height],this.width=i[0],this.height=i[1]):(e=[this.option.width,this.option.width],this.width=e[0],this.height=e[1]);break;case"free":this.width=this.option.width,this.height=this.option.height}},get:function(){return this._mode}}]),e}()});
//# sourceMappingURL=GeeTailor.js.map
